const a6_0x4b3d=['This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.','done','existsSync','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','Duplicate\x20Agent\x20ID\x20Detected','default','tasksRunnerOptions','writeFileSync','../../../utilities/dte-artifact-storage','.lock','floor','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20target(s)\x20[','SIGTERM','message','filter','../../../utilities/metric-logger','NX_AGENT_NAME','We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','@nrwl/nx-cloud','cacheableOperations','__awaiter','env','defineProperty','__esModule','getCIExecutionEnv','value','ENCRYPTION_KEY','length','map','printCacheableTargetsError','trim','getNxCacheDirectory','CIRCLECI','DistributedAgentApi','some','FileStorage','apply','printRunGroupError','split','options','getCIExecutionId','Other\x20Nx\x20Cloud\x20Agents\x20Detected','../../error/print-cacheable-targets-error','getBranch','getRunGroup','ErrorReporterApi','then','../../api/error-reporter.api','dte-agent','../../../utilities/environment','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.','../../file-storage/e2e-encryption','CIRCLE_STAGE','throw','next','SIGINT','encryptionKey','canDetectRunGroup','Agent\x20','completeRunGroupWithError','invokeTasksUsingRunMany','toString','/nx.json','./invoke-tasks-using-nx-imperative-api','yargs-parser','Agent\x20was\x20terminated\x20via\x20SIGTERM','./execute-tasks','runner','targets','Agent\x20was\x20terminated\x20via\x20SIGINT','readdirSync','exit','note','warn','startAgent','CIRCLE_JOB','strip-json-comments','random','printInvalidRunnerError','/lockfiles','invokeTasksUsingNxImperativeApi','./invoke-tasks-using-run-many','mkdirSync','executeTasks','Critical\x20Error\x20in\x20Agent:\x20\x22','../../error/print-invalid-runner-error','readFileSync'];(function(_0xb498d7,_0x4b3d70){const _0x28ecea=function(_0x1e8bf1){while(--_0x1e8bf1){_0xb498d7['push'](_0xb498d7['shift']());}};_0x28ecea(++_0x4b3d70);}(a6_0x4b3d,0x93));const a6_0x28ec=function(_0xb498d7,_0x4b3d70){_0xb498d7=_0xb498d7-0x0;let _0x28ecea=a6_0x4b3d[_0xb498d7];return _0x28ecea;};'use strict';var __awaiter=this&&this[a6_0x28ec('0x2f')]||function(_0x102274,_0x3bd1a0,_0x5a856f,_0x1f2186){function _0x33f7a0(_0x508aae){return _0x508aae instanceof _0x5a856f?_0x508aae:new _0x5a856f(function(_0x309054){_0x309054(_0x508aae);});}return new(_0x5a856f||(_0x5a856f=Promise))(function(_0x51f6dc,_0x3ed71e){function _0xd183fb(_0x508f24){try{_0x4f3391(_0x1f2186[a6_0x28ec('0x51')](_0x508f24));}catch(_0x2e2108){_0x3ed71e(_0x2e2108);}}function _0x213f92(_0x1fa61a){try{_0x4f3391(_0x1f2186[a6_0x28ec('0x50')](_0x1fa61a));}catch(_0x18f6b2){_0x3ed71e(_0x18f6b2);}}function _0x4f3391(_0x25bc78){_0x25bc78[a6_0x28ec('0x1c')]?_0x51f6dc(_0x25bc78['value']):_0x33f7a0(_0x25bc78[a6_0x28ec('0x34')])[a6_0x28ec('0x49')](_0xd183fb,_0x213f92);}_0x4f3391((_0x1f2186=_0x1f2186[a6_0x28ec('0x3f')](_0x102274,_0x3bd1a0||[]))['next']());});};Object[a6_0x28ec('0x31')](exports,a6_0x28ec('0x32'),{'value':!![]});exports[a6_0x28ec('0xe')]=void 0x0;const fs_1=require('fs');const stripJsonComments=require(a6_0x28ec('0x10'));const yargsParser=require(a6_0x28ec('0x4'));const environment_1=require(a6_0x28ec('0x4c'));const metric_logger_1=require(a6_0x28ec('0x2a'));const print_cacheable_targets_error_1=require(a6_0x28ec('0x45'));const print_invalid_runner_error_1=require(a6_0x28ec('0x19'));const print_run_group_error_1=require('../../error/print-run-group-error');const distributed_agent_api_1=require('./distributed-agent.api');const execute_tasks_1=require(a6_0x28ec('0x6'));const dte_artifact_storage_1=require(a6_0x28ec('0x23'));const file_storage_1=require('../../file-storage/file-storage');const e2e_encryption_1=require(a6_0x28ec('0x4e'));const error_reporter_api_1=require(a6_0x28ec('0x4a'));const invoke_tasks_using_run_many_1=require(a6_0x28ec('0x15'));const invoke_tasks_using_nx_imperative_api_1=require(a6_0x28ec('0x3'));const {output,initTasksRunner,workspaceRoot}=require('../../../utilities/nx-imports');const args=yargsParser(process['argv'],{'array':[a6_0x28ec('0x8')],'default':{}});if(args['targets']&&args['targets'][a6_0x28ec('0x36')]===0x1){args['targets']=args[a6_0x28ec('0x8')][0x0][a6_0x28ec('0x41')](',')[a6_0x28ec('0x37')](_0x3732aa=>_0x3732aa[a6_0x28ec('0x39')]());}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xfc542d=(0x0,environment_1[a6_0x28ec('0x46')])();const _0x4c13f1=(0x0,environment_1[a6_0x28ec('0x47')])();const _0x4c49ce=(0x0,environment_1[a6_0x28ec('0x43')])();const _0x2369e8=(0x0,environment_1[a6_0x28ec('0x33')])();if(!(0x0,print_run_group_error_1[a6_0x28ec('0x54')])(_0x4c13f1,_0x4c49ce)){(0x0,print_run_group_error_1[a6_0x28ec('0x40')])();process[a6_0x28ec('0xb')](0x1);}if(args[a6_0x28ec('0x8')]&&args[a6_0x28ec('0x8')]['length']){output[a6_0x28ec('0xc')]({'title':a6_0x28ec('0x26')+args['targets']['join'](',\x20')+']'});}else{output[a6_0x28ec('0xc')]({'title':'Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks'});}const _0x1409b8=JSON['parse'](stripJsonComments((0x0,fs_1[a6_0x28ec('0x1a')])(workspaceRoot+a6_0x28ec('0x2'))[a6_0x28ec('0x1')]()))[a6_0x28ec('0x21')][a6_0x28ec('0x20')];if(_0x1409b8[a6_0x28ec('0x7')]!==a6_0x28ec('0x2d')){(0x0,print_invalid_runner_error_1[a6_0x28ec('0x12')])();return process[a6_0x28ec('0xb')](0x1);}const _0x1cebe9=_0x1409b8[a6_0x28ec('0x42')];if(args['targets']&&args[a6_0x28ec('0x8')][a6_0x28ec('0x3d')](_0x5f15a0=>{var _0x2ddf8e;return!((_0x2ddf8e=_0x1cebe9[a6_0x28ec('0x2e')])===null||_0x2ddf8e===void 0x0?void 0x0:_0x2ddf8e['includes'](_0x5f15a0));})){const _0x3f8b38=args[a6_0x28ec('0x8')][a6_0x28ec('0x29')](_0x23a939=>{var _0x2381ec;return!((_0x2381ec=_0x1cebe9[a6_0x28ec('0x2e')])===null||_0x2381ec===void 0x0?void 0x0:_0x2381ec['includes'](_0x23a939));});(0x0,print_cacheable_targets_error_1[a6_0x28ec('0x38')])(_0x3f8b38);return process['exit'](0x1);}const _0x342e55=getAgentName();const _0x41f420=new distributed_agent_api_1[(a6_0x28ec('0x3c'))](_0x1cebe9,_0xfc542d,_0x4c13f1,_0x4c49ce,_0x2369e8,_0x342e55);createAgentLockfileAndSetUpListeners(_0x41f420,_0x1cebe9,_0x342e55);const _0x2486ce=new e2e_encryption_1['E2EEncryption'](environment_1[a6_0x28ec('0x35')]||_0x1cebe9[a6_0x28ec('0x53')]);const _0x3cedaf=new error_reporter_api_1[(a6_0x28ec('0x48'))](_0x1cebe9);const _0x116f6f=new dte_artifact_storage_1['DteArtifactStorage'](new file_storage_1[(a6_0x28ec('0x3e'))](_0x2486ce,_0x3cedaf,_0x1cebe9,a6_0x28ec('0x4b')),(0x0,environment_1[a6_0x28ec('0x3a')])(_0x1cebe9));const _0x3e84f9=initTasksRunner?yield(0x0,invoke_tasks_using_nx_imperative_api_1[a6_0x28ec('0x14')])(_0x1cebe9):yield(0x0,invoke_tasks_using_run_many_1[a6_0x28ec('0x0')])(_0x1cebe9);return(0x0,execute_tasks_1[a6_0x28ec('0x17')])(_0x342e55,_0x41f420,_0x116f6f,_0x3e84f9,args[a6_0x28ec('0x8')])[a6_0x28ec('0x49')](_0x313ad0=>__awaiter(this,void 0x0,void 0x0,function*(){yield(0x0,metric_logger_1['submitRunMetrics'])(_0x1cebe9);return _0x313ad0;}))['catch'](_0x22b569=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x41f420[a6_0x28ec('0x56')](a6_0x28ec('0x18')+_0x22b569[a6_0x28ec('0x28')]+'\x22');throw _0x22b569;}));});}exports[a6_0x28ec('0xe')]=startAgent;function getAgentName(){if(process[a6_0x28ec('0x30')]['NX_AGENT_NAME']!==undefined){return process[a6_0x28ec('0x30')][a6_0x28ec('0x2b')];}else if(process[a6_0x28ec('0x30')]['CIRCLECI']!==undefined&&process[a6_0x28ec('0x30')][a6_0x28ec('0x4f')]){return process[a6_0x28ec('0x30')][a6_0x28ec('0x4f')];}else if(process[a6_0x28ec('0x30')][a6_0x28ec('0x3b')]!==undefined&&process[a6_0x28ec('0x30')][a6_0x28ec('0xf')]){return process[a6_0x28ec('0x30')][a6_0x28ec('0xf')];}else{return a6_0x28ec('0x55')+Math[a6_0x28ec('0x25')](Math[a6_0x28ec('0x11')]()*0x186a0);}}function createAgentLockfileAndSetUpListeners(_0x1b18f4,_0xf6b334,_0x335c46){const _0x55973c=(0x0,environment_1[a6_0x28ec('0x3a')])(_0xf6b334);const _0x1b6544=_0x55973c+a6_0x28ec('0x13');const _0x1fe67f=_0x1b6544+'/'+_0x335c46+a6_0x28ec('0x24');if(!(0x0,fs_1[a6_0x28ec('0x1d')])(_0x1b6544)){(0x0,fs_1[a6_0x28ec('0x16')])(_0x1b6544,{'recursive':!![]});}const _0x4e03b=(0x0,fs_1[a6_0x28ec('0xa')])(_0x1b6544);if(_0x4e03b[a6_0x28ec('0x36')]){if(_0x4e03b['includes'](_0x335c46+'.lock')){output['error']({'title':a6_0x28ec('0x1f'),'bodyLines':['We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.','',a6_0x28ec('0x4d')]});process[a6_0x28ec('0xb')](0x1);}output[a6_0x28ec('0xd')]({'title':a6_0x28ec('0x44'),'bodyLines':[a6_0x28ec('0x2c'),'',a6_0x28ec('0x1b'),a6_0x28ec('0x1e')]});}(0x0,fs_1[a6_0x28ec('0x22')])(_0x1fe67f,'');process['on']('exit',_0x494194=>{cleanupAgentLockfile(_0x1fe67f,_0x494194);});process['on'](a6_0x28ec('0x27'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x1b18f4[a6_0x28ec('0x56')](a6_0x28ec('0x5'));cleanupAgentLockfile(_0x1fe67f,0x1);}));process['on'](a6_0x28ec('0x52'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x1b18f4[a6_0x28ec('0x56')](a6_0x28ec('0x9'));cleanupAgentLockfile(_0x1fe67f,0x1);}));}function cleanupAgentLockfile(_0x37bcd3,_0x5c0d7f){if((0x0,fs_1['existsSync'])(_0x37bcd3)){(0x0,fs_1['unlinkSync'])(_0x37bcd3);process[a6_0x28ec('0xb')](_0x5c0d7f);}}