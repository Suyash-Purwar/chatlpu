const a1_0x1830=['skipNxCache','toISOString','__esModule','accessToken','daemon','ENCRYPTION_KEY','VERBOSE_LOGGING','getRunGroup','all','../../terminal-output/output-obfuscator','printCacheHitsMessage','defineProperty','../../../utilities/environment','startRun','writeFileSync','error','CloudRunApi','enabled','generateUniqueLinkId','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','./cloud-enabled-life-cycle','../../terminal-output/end-of-run-message','tasks-hashes-','next','FileStorage','throw','done','rxjs/internal/Subject','\x20isn\x27t\x20recorded','encryptionKey','filter','exit','../../../utilities/metric-logger','../../../utilities/nx-imports','catch','Executed\x20tasks\x20with\x20hashes:\x20','./id-generator','message','store','anyErrors','waitForStoreRequestsToComplete','env','note','parseCommand','getCIExecutionEnv','../../api/error-reporter.api','.commit','warn','getCIExecutionId','cloud-enabled-runner','printMessages','hash','uploadedToStorage','forEach','obfuscate','complete','cloudEnabledTasksRunner','@nrwl/nx-cloud/lib/daemon/process-run-end','lifeCycle','../../terminal-output/message-reporter','map','agentRunningInDistributedExecution','getNxCacheDirectory','storedHashes','ACCESS_TOKEN','Task\x20with\x20hash\x20','subscribe','fs-extra','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','value','toString','../../file-storage/e2e-encryption','MessageReporter','ErrorReporterApi','taskId','push','getMachineInfo','join','getBranch','length','url','./cloud-remote-cache','apply','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.','pathExists','stringify','assign','EndOfRunMessage','./cloud-run.api','then'];(function(_0x4c9b36,_0x183017){const _0x549437=function(_0x4f70f9){while(--_0x4f70f9){_0x4c9b36['push'](_0x4c9b36['shift']());}};_0x549437(++_0x183017);}(a1_0x1830,0x1a6));const a1_0x5494=function(_0x4c9b36,_0x183017){_0x4c9b36=_0x4c9b36-0x0;let _0x549437=a1_0x1830[_0x4c9b36];return _0x549437;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x42e197,_0x3fb696,_0x56f34e,_0x4dad50){function _0x233c84(_0x5eaa7f){return _0x5eaa7f instanceof _0x56f34e?_0x5eaa7f:new _0x56f34e(function(_0x52a410){_0x52a410(_0x5eaa7f);});}return new(_0x56f34e||(_0x56f34e=Promise))(function(_0x44ea01,_0x3a14b9){function _0x2df67b(_0x22a099){try{_0x4d8e4a(_0x4dad50[a1_0x5494('0x33')](_0x22a099));}catch(_0x26b34a){_0x3a14b9(_0x26b34a);}}function _0x3e342b(_0x1b82c6){try{_0x4d8e4a(_0x4dad50[a1_0x5494('0x35')](_0x1b82c6));}catch(_0x118598){_0x3a14b9(_0x118598);}}function _0x4d8e4a(_0x4c2cf3){_0x4c2cf3[a1_0x5494('0x36')]?_0x44ea01(_0x4c2cf3[a1_0x5494('0x7')]):_0x233c84(_0x4c2cf3[a1_0x5494('0x7')])[a1_0x5494('0x1b')](_0x2df67b,_0x3e342b);}_0x4d8e4a((_0x4dad50=_0x4dad50[a1_0x5494('0x14')](_0x42e197,_0x3fb696||[]))[a1_0x5494('0x33')]());});};Object[a1_0x5494('0x27')](exports,a1_0x5494('0x1e'),{'value':!![]});exports[a1_0x5494('0x54')]=void 0x0;const message_reporter_1=require(a1_0x5494('0x57'));const end_of_run_message_1=require(a1_0x5494('0x31'));const output_obfuscator_1=require(a1_0x5494('0x25'));const cloud_enabled_life_cycle_1=require(a1_0x5494('0x30'));const file_storage_1=require('../../file-storage/file-storage');const e2e_encryption_1=require(a1_0x5494('0x9'));const environment_1=require(a1_0x5494('0x28'));const cloud_remote_cache_1=require(a1_0x5494('0x13'));const cloud_run_api_1=require(a1_0x5494('0x1a'));const fs_1=require('fs');const path=require('path');const path_1=require('path');const metric_logger_1=require(a1_0x5494('0x3c'));const error_reporter_api_1=require(a1_0x5494('0x49'));const fs_extra_1=require(a1_0x5494('0x5'));const id_generator_1=require(a1_0x5494('0x40'));const {tasksRunner,output}=require(a1_0x5494('0x3d'));function createApi(_0x10cd7b,_0x479745,_0x2e0fff){const _0x42c1f8=(0x0,environment_1[a1_0x5494('0xe')])(_0x479745);return new cloud_run_api_1[(a1_0x5494('0x2c'))](_0x10cd7b,_0x2e0fff,_0x479745,_0x42c1f8);}function storeTaskHashes(_0xff8459,_0x4c0a16,_0x20219a){const _0x20443b=JSON[a1_0x5494('0x17')](_0xff8459['map'](_0x525b50=>({'taskId':_0x525b50[a1_0x5494('0xc')],'hash':_0x525b50[a1_0x5494('0x4f')]})));if(environment_1[a1_0x5494('0x22')]){output[a1_0x5494('0x46')]({'title':a1_0x5494('0x3f')+_0x20443b});}(0x0,fs_1[a1_0x5494('0x2a')])(path[a1_0x5494('0xf')](_0x4c0a16,a1_0x5494('0x32')+_0x20219a),_0x20443b);}function storeLocalCacheHits(_0x3d8321,_0x537b3e,_0x3bd0bf){const _0x190eca=_0x3d8321[a1_0x5494('0x3a')](_0x10f1d5=>_0x10f1d5['cacheStatus']==='local-cache-hit')[a1_0x5494('0x58')](_0x1c0487=>_0x1c0487['hash']);_0x190eca[a1_0x5494('0x51')](_0x2bfade=>_0x537b3e[a1_0x5494('0x42')](_0x2bfade,_0x3bd0bf));}function onComplete({daemon,options,fileStorage,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,storeInCurrentProcess,distributedExecutionId,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x15fec8=new Date()[a1_0x5494('0x1d')]();const _0x5b87cc=(0x0,environment_1[a1_0x5494('0x10')])();const _0x6151d={'command':outputObfuscator[a1_0x5494('0x52')]((0x0,environment_1[a1_0x5494('0x47')])()),'startTime':runStartTime,'endTime':_0x15fec8,'distributedExecutionId':distributedExecutionId,'branch':_0x5b87cc,'runGroup':(0x0,environment_1[a1_0x5494('0x23')])(),'sha':_0x5b87cc?(0x0,environment_1['extractGitSha'])():undefined,'inner':inner};const _0x2656b6={'branch':_0x5b87cc,'runGroup':(0x0,environment_1['getRunGroup'])(),'ciExecutionId':(0x0,environment_1[a1_0x5494('0x4c')])(),'ciExecutionEnv':(0x0,environment_1[a1_0x5494('0x48')])()};if(storeInCurrentProcess){if((0x0,environment_1[a1_0x5494('0x59')])(distributedExecutionId)){const _0x5668da=(0x0,environment_1[a1_0x5494('0x0')])(options);storeTaskHashes(taskExecutions,_0x5668da,distributedExecutionId);storeLocalCacheHits(taskExecutions,remoteCache,_0x5668da);}try{yield remoteCache[a1_0x5494('0x44')]();}catch(_0x3d7f1b){output[a1_0x5494('0x2b')]({'title':a1_0x5494('0x15')});messages[a1_0x5494('0x4e')]();return![];}for(const _0x3ab8cd of fileStorage[a1_0x5494('0x1')]){const _0x5e410e=taskExecutions['find'](_0x4fd1f8=>_0x4fd1f8[a1_0x5494('0x4f')]===_0x3ab8cd);if(!_0x5e410e){throw new Error(a1_0x5494('0x3')+_0x3ab8cd+a1_0x5494('0x38'));}_0x5e410e[a1_0x5494('0x50')]=!![];}try{yield api['endRun'](_0x6151d,taskExecutions,_0x2656b6);}catch(_0x2a192d){output[a1_0x5494('0x2b')]({'title':'Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.'});messages['printMessages']();return![];}yield(0x0,metric_logger_1['submitRunMetrics'])(options);}else{try{const _0x54dad3=environment_1[a1_0x5494('0x2')]?environment_1[a1_0x5494('0x2')]:options[a1_0x5494('0x1f')];const _0x29a881=(0x0,id_generator_1[a1_0x5494('0x2e')])();yield daemon['processInBackground'](a1_0x5494('0x55'),{'encryptionKey':encryptionKey,'runnerOptions':Object[a1_0x5494('0x18')](Object[a1_0x5494('0x18')]({},options),{'accessToken':_0x54dad3}),'delayedStoreRequests':remoteCache['delayedStoreRequests'],'ciExecutionContext':_0x2656b6,'runEnd':{'runData':_0x6151d,'taskExecutions':taskExecutions,'linkId':_0x29a881}});runContext['runUrl']=(options[a1_0x5494('0x12')]||'https://nx.app')+'/runs/'+_0x29a881;}catch(_0x5200dd){output[a1_0x5494('0x4b')]({'title':'Nx\x20Cloud\x20Problems','bodyLines':[_0x5200dd[a1_0x5494('0x41')]||_0x5200dd[a1_0x5494('0x8')]()]});return![];}}if(versionOfNxBefore133){setTimeout(()=>{messages[a1_0x5494('0x4e')]();if(!messages[a1_0x5494('0x43')]&&!inner){endOfRunMessage['printCacheHitsMessage']();}},0x0);}else{messages[a1_0x5494('0x4e')]();if(!messages[a1_0x5494('0x43')]&&!inner){endOfRunMessage[a1_0x5494('0x26')]();}}return!![];});}function createLifeCycle(_0x3e1e93,_0x2547b0,_0x3aeb81,_0x50f2f0){const _0x7312f5=new cloud_enabled_life_cycle_1['CloudEnabledLifeCycle'](_0x3e1e93,(0x0,environment_1[a1_0x5494('0x0')])(_0x2547b0),!![],_0x2547b0['cacheableOperations']||[],_0x3aeb81,_0x50f2f0);try{const {CompositeLifeCycle}=require(a1_0x5494('0x3d'));if(!CompositeLifeCycle)return _0x7312f5;return new CompositeLifeCycle([_0x2547b0[a1_0x5494('0x56')],_0x7312f5]);}catch(_0x33fc68){return _0x7312f5;}}function fetchUrlsForKnownHashesUpfront(_0x29fde4,_0x448317,_0x21c41f,_0x2f6d35,_0x553a93){return __awaiter(this,void 0x0,void 0x0,function*(){if(_0x2f6d35[a1_0x5494('0x1c')])return;let _0x506247=_0x21c41f[a1_0x5494('0x58')](_0x105598=>_0x105598['hash'])[a1_0x5494('0x3a')](_0x51e8ac=>!!_0x51e8ac);const _0x250efe=(0x0,environment_1['getNxCacheDirectory'])(_0x2f6d35);const _0x9e5732=yield Promise[a1_0x5494('0x24')](_0x506247[a1_0x5494('0x58')](_0x342303=>{const _0x5bf8c1=(0x0,path_1['join'])(_0x250efe,_0x342303+a1_0x5494('0x4a'));return(0x0,fs_extra_1[a1_0x5494('0x16')])(_0x5bf8c1);}));const _0x3ed0bf=[];for(let _0x23cb6b=0x0;_0x23cb6b<_0x9e5732['length'];++_0x23cb6b){if(!_0x9e5732[_0x23cb6b]){_0x3ed0bf[a1_0x5494('0xd')](_0x506247[_0x23cb6b]);}}if(_0x3ed0bf[a1_0x5494('0x11')]>0x0){const _0xb3a7d8=_0x29fde4[a1_0x5494('0x29')](_0x553a93,_0x3ed0bf);for(const _0x411d5e of _0x3ed0bf){_0x448317['requests'][_0x411d5e]=_0xb3a7d8;}}});}function cloudEnabledTasksRunner(_0x38f117,_0xc80a73,_0x29dac7,_0x43e740=![]){var _0x2b5885;const _0x54625c=process[a1_0x5494('0x45')][a1_0x5494('0x6')];const _0x59993f={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x38f117};const _0x4d14d7=_0xc80a73['lifeCycle']===undefined;const _0x15c08c=[];const _0xe9fe56=new message_reporter_1[(a1_0x5494('0xa'))](_0xc80a73);const _0x220de4=createApi(_0xe9fe56,_0xc80a73,_0x59993f);const _0x160afe=new end_of_run_message_1[(a1_0x5494('0x19'))](_0x59993f,_0x15c08c,_0x54625c);const _0x3e3feb=new output_obfuscator_1['OutputObfuscator'](_0xc80a73['maskedProperties']);const _0x43ccc8=new Date()['toISOString']();const _0x4aa721=createLifeCycle(_0x59993f,_0xc80a73,_0x3e3feb,_0x15c08c);const _0x4a03d3=environment_1[a1_0x5494('0x21')]||_0xc80a73[a1_0x5494('0x39')];const _0x5051cb=new e2e_encryption_1['E2EEncryption'](_0x4a03d3);const _0x4109d4=new error_reporter_api_1[(a1_0x5494('0xb'))](_0xc80a73);const _0xaedaa3=(0x0,environment_1[a1_0x5494('0x59')])(_0x54625c)||!((_0x2b5885=_0x29dac7[a1_0x5494('0x20')])===null||_0x2b5885===void 0x0?void 0x0:_0x2b5885[a1_0x5494('0x2d')]());const _0x3b6b99=new file_storage_1[(a1_0x5494('0x34'))](_0x5051cb,_0x4109d4,_0xc80a73,a1_0x5494('0x4d'));const _0x133186=new cloud_remote_cache_1['CloudRemoteCache'](_0xe9fe56,_0x220de4,_0x59993f,_0x3b6b99,_0x54625c,_0xaedaa3);fetchUrlsForKnownHashesUpfront(_0x220de4,_0x59993f,_0x38f117,_0xc80a73,_0x54625c);delete process['env']['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'];const _0x1a84b1=tasksRunner(_0x38f117,Object[a1_0x5494('0x18')](Object[a1_0x5494('0x18')]({},_0xc80a73),{'remoteCache':_0x133186,'lifeCycle':_0x4aa721}),_0x29dac7);if(_0x1a84b1[a1_0x5494('0x4')]){const {Subject}=require(a1_0x5494('0x37'));const _0x4b11e5=new Subject();_0x1a84b1[a1_0x5494('0x4')]({'next':_0x443b6d=>_0x4b11e5[a1_0x5494('0x33')](_0x443b6d),'error':_0x8c32b0=>_0x4b11e5[a1_0x5494('0x2b')](_0x8c32b0),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x4997ee=yield onComplete({'daemon':_0x29dac7[a1_0x5494('0x20')],'options':_0xc80a73,'fileStorage':_0x3b6b99,'remoteCache':_0x133186,'api':_0x220de4,'outputObfuscator':_0x3e3feb,'runStartTime':_0x43ccc8,'messages':_0xe9fe56,'endOfRunMessage':_0x160afe,'taskExecutions':_0x15c08c,'versionOfNxBefore133':_0x4d14d7,'inner':_0x43e740,'encryptionKey':_0x4a03d3,'storeInCurrentProcess':_0xaedaa3,'runContext':_0x59993f,'distributedExecutionId':_0x54625c});if(!_0x4997ee&&(0x0,environment_1[a1_0x5494('0x59')])(_0x54625c)){process[a1_0x5494('0x3b')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}_0x4b11e5[a1_0x5494('0x53')]();})});return _0x4b11e5;}else{return _0x1a84b1[a1_0x5494('0x1b')](_0x36a4a6=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x1be39e=yield onComplete({'daemon':_0x29dac7[a1_0x5494('0x20')],'options':_0xc80a73,'fileStorage':_0x3b6b99,'remoteCache':_0x133186,'api':_0x220de4,'outputObfuscator':_0x3e3feb,'runStartTime':_0x43ccc8,'messages':_0xe9fe56,'endOfRunMessage':_0x160afe,'taskExecutions':_0x15c08c,'versionOfNxBefore133':_0x4d14d7,'inner':_0x43e740,'encryptionKey':_0x4a03d3,'storeInCurrentProcess':_0xaedaa3,'runContext':_0x59993f,'distributedExecutionId':_0x54625c});if(!_0x1be39e&&(0x0,environment_1[a1_0x5494('0x59')])(_0x54625c)){process[a1_0x5494('0x3b')](environment_1[a1_0x5494('0x2f')]);}return _0x36a4a6;}))[a1_0x5494('0x3e')](_0x4e1e63=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x484498=yield onComplete({'daemon':_0x29dac7['daemon'],'options':_0xc80a73,'fileStorage':_0x3b6b99,'remoteCache':_0x133186,'api':_0x220de4,'outputObfuscator':_0x3e3feb,'runStartTime':_0x43ccc8,'messages':_0xe9fe56,'endOfRunMessage':_0x160afe,'taskExecutions':_0x15c08c,'versionOfNxBefore133':_0x4d14d7,'inner':_0x43e740,'encryptionKey':_0x4a03d3,'storeInCurrentProcess':_0xaedaa3,'runContext':_0x59993f,'distributedExecutionId':_0x54625c});if(!_0x484498&&(0x0,environment_1['agentRunningInDistributedExecution'])(_0x54625c)){process[a1_0x5494('0x3b')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}throw _0x4e1e63;}));}}exports[a1_0x5494('0x54')]=cloudEnabledTasksRunner;