const a3_0x4ac4=['...','Invalid\x20end\x20run\x20response','__awaiter','stack','map','application/octet-stream','getBranch','RunStart','../../../utilities/nx-imports','uploadedToStorage','createMetricRecorder','apiError','length','Invalid\x20Nx\x20Cloud\x20response:\x20','../../../utilities/is-private-cloud','status','promisify','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','string','nxCloudVersion','recordMetric','../../../utilities/axios','Run\x20completion\x20responded\x20with\x20`undefined`.','extractErrorMessage','terminalOutput','__esModule','assign','createReqBody','defineProperty','next','Run\x20Details:','mapRespToPerfEntry','urls','from','createApiAxiosInstance','success','value','messages','runContext','../../../utilities/metric-logger','isConnectedToPrivateCloud','defaults','unknown','parse','CloudRunApi','apply','response','post','then','note','readFileSync','message','data','../../../utilities/environment','runUrl','stringify','devDependencies','axiosException','error','Invalid\x20end\x20run\x20response:\x20','toString','endRun','gzip','startRun','RUNNER_FAILURE_PERF_ENTRY','headers','slice','machineInfo','getCIExecutionEnv','api','printDuration','apiAxiosInstance'];(function(_0x385f8c,_0x4ac416){const _0xd72646=function(_0x14c4a9){while(--_0x14c4a9){_0x385f8c['push'](_0x385f8c['shift']());}};_0xd72646(++_0x4ac416);}(a3_0x4ac4,0x151));const a3_0xd726=function(_0x385f8c,_0x4ac416){_0x385f8c=_0x385f8c-0x0;let _0xd72646=a3_0x4ac4[_0x385f8c];return _0xd72646;};'use strict';var __awaiter=this&&this[a3_0xd726('0x19')]||function(_0x1ab683,_0x2da259,_0x333853,_0x5a7f5b){function _0xd18f00(_0x497ede){return _0x497ede instanceof _0x333853?_0x497ede:new _0x333853(function(_0x4505dc){_0x4505dc(_0x497ede);});}return new(_0x333853||(_0x333853=Promise))(function(_0x2105c6,_0x2bd971){function _0x136f04(_0x4a1f94){try{_0x2e5e95(_0x5a7f5b[a3_0xd726('0x34')](_0x4a1f94));}catch(_0x1fbbf1){_0x2bd971(_0x1fbbf1);}}function _0x2e0f59(_0x2a908d){try{_0x2e5e95(_0x5a7f5b['throw'](_0x2a908d));}catch(_0x5e177d){_0x2bd971(_0x5e177d);}}function _0x2e5e95(_0x1818c7){_0x1818c7['done']?_0x2105c6(_0x1818c7[a3_0xd726('0x3b')]):_0xd18f00(_0x1818c7['value'])[a3_0xd726('0x47')](_0x136f04,_0x2e0f59);}_0x2e5e95((_0x5a7f5b=_0x5a7f5b[a3_0xd726('0x44')](_0x1ab683,_0x2da259||[]))['next']());});};Object[a3_0xd726('0x33')](exports,a3_0xd726('0x30'),{'value':!![]});exports[a3_0xd726('0x43')]=void 0x0;const axios_1=require(a3_0xd726('0x2c'));const environment_1=require(a3_0xd726('0x4'));const fs_1=require('fs');const zlib_1=require('zlib');const util_1=require('util');const metric_logger_1=require(a3_0xd726('0x3e'));const is_private_cloud_1=require(a3_0xd726('0x25'));const {output}=require(a3_0xd726('0x1f'));class CloudRunApi{constructor(_0x55c9ee,_0x5d0765,_0x3b4f32,_0x212171){this[a3_0xd726('0x3c')]=_0x55c9ee;this[a3_0xd726('0x3d')]=_0x5d0765;this[a3_0xd726('0x12')]=_0x212171;this[a3_0xd726('0x16')]=(0x0,axios_1[a3_0xd726('0x39')])(_0x3b4f32);}[a3_0xd726('0xe')](_0x24b5cd,_0x436af0){var _0x18881b;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0xd726('0x3c')][a3_0xd726('0x22')])return{};const _0x32e611=(0x0,metric_logger_1[a3_0xd726('0x21')])('startRun');try{const _0x565015={'meta':{'nxCloudVersion':this[a3_0xd726('0x2a')]()},'branch':(0x0,environment_1[a3_0xd726('0x1d')])(),'runGroup':(0x0,environment_1['getRunGroup'])(),'ciExecutionId':(0x0,environment_1['getCIExecutionId'])(),'ciExecutionEnv':(0x0,environment_1[a3_0xd726('0x13')])(),'distributedExecutionId':_0x24b5cd,'hashes':_0x436af0};if(environment_1['VERBOSE_LOGGING']){output[a3_0xd726('0x0')]({'title':a3_0xd726('0x1e'),'bodyLines':['\x0a'+JSON[a3_0xd726('0x6')](_0x565015,null,0x2)]});}const _0x595151=yield(0x0,axios_1[a3_0xd726('0x15')])('RunStart\x20duration',()=>(0x0,axios_1['axiosMultipleTries'])(()=>this['apiAxiosInstance'][a3_0xd726('0x46')]('/nx-cloud/runs/start',_0x565015)));_0x32e611['recordMetric']((0x0,metric_logger_1[a3_0xd726('0x36')])(_0x595151));if(_0x595151['data']&&_0x595151[a3_0xd726('0x3')][a3_0xd726('0x2')]){this[a3_0xd726('0x3c')][a3_0xd726('0x2')]=_0x595151[a3_0xd726('0x3')][a3_0xd726('0x2')];}if(!_0x595151[a3_0xd726('0x3')]||!_0x595151[a3_0xd726('0x3')][a3_0xd726('0x37')]){this[a3_0xd726('0x3c')]['apiError']=a3_0xd726('0x24')+JSON[a3_0xd726('0x6')](_0x595151['data']);return{};}return _0x595151['data'][a3_0xd726('0x37')];}catch(_0x59ed0f){_0x32e611[a3_0xd726('0x2b')](((_0x18881b=_0x59ed0f===null||_0x59ed0f===void 0x0?void 0x0:_0x59ed0f[a3_0xd726('0x8')])===null||_0x18881b===void 0x0?void 0x0:_0x18881b[a3_0xd726('0x45')])?(0x0,metric_logger_1[a3_0xd726('0x36')])(_0x59ed0f[a3_0xd726('0x8')]['response']):metric_logger_1[a3_0xd726('0xf')]);this[a3_0xd726('0x3c')][a3_0xd726('0x22')]=this[a3_0xd726('0x3c')][a3_0xd726('0x2e')](_0x59ed0f,a3_0xd726('0x14'));return{};}});}[a3_0xd726('0x32')](_0x37f6ec,_0x425e32,_0x5e88ff,_0x590fef){if((0x0,is_private_cloud_1['isConnectedToPrivateCloud'])()){for(let _0x52e0e7 of _0x425e32){delete _0x52e0e7[a3_0xd726('0x20')];}}const _0x1a4076=Object[a3_0xd726('0x31')](Object[a3_0xd726('0x31')]({'meta':{'nxCloudVersion':this[a3_0xd726('0x2a')]()},'tasks':_0x425e32,'run':_0x37f6ec,'linkId':_0x590fef},(0x0,is_private_cloud_1[a3_0xd726('0x3f')])()?{}:_0x5e88ff),{'machineInfo':this[a3_0xd726('0x12')]});return JSON['stringify'](_0x1a4076);}[a3_0xd726('0xc')](_0x1f9603,_0x61047a,_0x2b3162,_0x176855){var _0x52f68e,_0x1ce348;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0xd726('0x3c')][a3_0xd726('0x22')])return![];let _0xb97c22=this[a3_0xd726('0x32')](_0x1f9603,_0x61047a,_0x2b3162,_0x176855);if(_0xb97c22[a3_0xd726('0x23')]>0x14*0x3e8*0x3e8){_0xb97c22=this[a3_0xd726('0x32')](_0x1f9603,_0x61047a[a3_0xd726('0x1b')](_0x5b5d3a=>Object['assign'](Object[a3_0xd726('0x31')]({},_0x5b5d3a),{'hashDetails':undefined})),_0x2b3162,_0x176855);}const _0x11ad0a=Buffer[a3_0xd726('0x38')](_0xb97c22);const _0x5d9fb6=yield(0x0,util_1[a3_0xd726('0x27')])(zlib_1['gzip'])(_0x11ad0a);const _0x5d6cd5=(0x0,metric_logger_1['createMetricRecorder'])(a3_0xd726('0xc'));try{if(environment_1['VERBOSE_LOGGING']){const _0x173d95=_0x61047a[a3_0xd726('0x1b')](_0x5d0944=>{return Object[a3_0xd726('0x31')](Object[a3_0xd726('0x31')]({},_0x5d0944),{'terminalOutput':_0x5d0944['terminalOutput']?_0x5d0944[a3_0xd726('0x2f')][a3_0xd726('0x11')](0x0,0x14)+a3_0xd726('0x17'):undefined});});output[a3_0xd726('0x0')]({'title':'RunEnd.\x20Completed\x20tasks','bodyLines':['\x0a'+JSON['stringify'](_0x173d95,null,0x2)]});}const _0xe6d9ed=yield(0x0,axios_1['printDuration'])('RunEnd\x20duration',()=>(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0xd726('0x16')][a3_0xd726('0x46')]('/nx-cloud/runs/end',_0x5d9fb6,{'headers':Object['assign'](Object[a3_0xd726('0x31')]({},this[a3_0xd726('0x16')][a3_0xd726('0x40')][a3_0xd726('0x10')]),{'Content-Encoding':a3_0xd726('0xd'),'Content-Type':a3_0xd726('0x1c')})})));if(_0xe6d9ed){_0x5d6cd5[a3_0xd726('0x2b')]((0x0,metric_logger_1[a3_0xd726('0x36')])(_0xe6d9ed));if(_0xe6d9ed[a3_0xd726('0x3')]&&_0xe6d9ed[a3_0xd726('0x3')][a3_0xd726('0x5')]&&_0xe6d9ed[a3_0xd726('0x3')][a3_0xd726('0x26')]===a3_0xd726('0x3a')){this[a3_0xd726('0x3d')]['runUrl']=_0xe6d9ed[a3_0xd726('0x3')][a3_0xd726('0x5')];return!![];}if(_0xe6d9ed[a3_0xd726('0x3')]&&_0xe6d9ed['data']['status']){this[a3_0xd726('0x3c')][a3_0xd726('0x22')]=a3_0xd726('0xa')+JSON[a3_0xd726('0x6')](_0xe6d9ed['data'][a3_0xd726('0x2')]);}else if(_0xe6d9ed[a3_0xd726('0x3')]&&typeof _0xe6d9ed['data']===a3_0xd726('0x29')){if(_0xe6d9ed[a3_0xd726('0x3')]!==a3_0xd726('0x3a')){this[a3_0xd726('0x3c')][a3_0xd726('0x22')]=a3_0xd726('0xa')+JSON[a3_0xd726('0x6')](_0xe6d9ed[a3_0xd726('0x3')]);}}else{this[a3_0xd726('0x3c')][a3_0xd726('0x22')]=a3_0xd726('0xa')+JSON['stringify'](_0xe6d9ed[a3_0xd726('0x3')]);}if(environment_1['VERBOSE_LOGGING']){output['note']({'title':a3_0xd726('0x18'),'bodyLines':[JSON[a3_0xd726('0x6')](_0xe6d9ed[a3_0xd726('0x3')],null,0x2)]});}}else{output[a3_0xd726('0x9')]({'title':a3_0xd726('0x28'),'bodyLines':[a3_0xd726('0x2d'),a3_0xd726('0x35'),JSON[a3_0xd726('0x6')](_0x1f9603,null,0x2),'Stack\x20Trace:',JSON['stringify'](new Error()[a3_0xd726('0x1a')],null,0x2)]});}return![];}catch(_0x2d2b66){_0x5d6cd5[a3_0xd726('0x2b')](((_0x52f68e=_0x2d2b66===null||_0x2d2b66===void 0x0?void 0x0:_0x2d2b66[a3_0xd726('0x8')])===null||_0x52f68e===void 0x0?void 0x0:_0x52f68e['response'])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x2d2b66[a3_0xd726('0x8')][a3_0xd726('0x45')]):metric_logger_1[a3_0xd726('0xf')]);const _0x32df41=(_0x1ce348=_0x2d2b66[a3_0xd726('0x8')])!==null&&_0x1ce348!==void 0x0?_0x1ce348:_0x2d2b66;this[a3_0xd726('0x3c')][a3_0xd726('0x22')]=this[a3_0xd726('0x3c')]['extractErrorMessage'](_0x32df41,a3_0xd726('0x14'));return![];}});}['nxCloudVersion'](){try{const _0x2923df=JSON[a3_0xd726('0x42')]((0x0,fs_1[a3_0xd726('0x1')])('package.json')[a3_0xd726('0xb')]());return _0x2923df[a3_0xd726('0x7')]['@nrwl/nx-cloud'];}catch(_0x3d63f0){return a3_0xd726('0x41');}}}exports[a3_0xd726('0x43')]=CloudRunApi;